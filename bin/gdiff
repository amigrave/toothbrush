#!/bin/bash
# I think this is a variation of a script discussed at:
# http://kerneltrap.org/mailarchive/git/2007/11/21/435536
#
# Filemerge.app must not already be open before running
# this script, or opendiff below will return immediately,
# and the TMPDIRs deleted before it gets the chance to read
# them.

git difftool -t opendiff -y
exit 0
 
if test $# = 0; then
   OLD=`git write-tree`
elif test "$1" = --cached; then
   OLD=HEAD
   NEW=`git write-tree`
   shift
fi
if test $# -gt 0; then
   OLD="$1"; shift
fi
test $# -gt 0 && test -z "$CACHED" && NEW="$1"
 
TMPDIR1=`mktemp -d /tmp/gdiff-XXXXX`
git archive --format=tar $OLD | (cd $TMPDIR1; tar xf -)
if test -z "$NEW"; then
   TMPDIR2=$(git rev-parse --show-cdup)
   test -z "$cdup" && TMPDIR2=.
else
   TMPDIR2=`mktemp -d /tmp/gdiff-XXXXX`
   git archive --format=tar $NEW | (cd $TMPDIR2; tar xf -)
fi
 
opendiff $TMPDIR1 $TMPDIR2 | cat
rm -rf $TMPDIR1
test ! -z "$NEW" && rm -rf $TMPDIR2
